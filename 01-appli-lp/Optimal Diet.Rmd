---
title: "Optimal Diet"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This code is an attempt to reproduce the result of Stigler's paper : "The cost of subsistence". He tries to find the optimal bundle of food that should be sent to soldiers during WW2, optimal in the sens that cost is minimized, and that the soldiers will get their daily minimum requirements in nutrients. 

The army has a whole bunch of ingredients at its disposal, and knows exactly how much nutrients each unit of ingredients brings. 

First, we want to import the data to be able to work with it. 

```{r Setting up the data, message=FALSE}

library(gurobi)
thepath = getwd()
filename="/StiglerData1939.txt"
thedata = as.matrix(read.csv(paste0(thepath,filename),sep="\t", header=T))
nbCommodities=length(which(thedata[,1] != "" ))-1
names = thedata[1:nbCommodities,1]
themat	= matrix( as.numeric(thedata[,3:13]), ncol = 11)
themat[is.na(themat)] = 0

```

One needs to check that the number of commodities equals 77.

# The Model

The problem is an optimization one: we want to minimize costs provided that soldiers are fed with enough nutrients to cover their needs. The objective function here is linear. We are thus considering the following model: 

$\displaystyle\min_{\begin{array}{c} e \geq 0 \\ e \in \mathbb{R}^{I} \end{array}} e^T\mathbb{1}_I$ 

subject to $N^Te \geq d$

where $\mathbb{1}_I$ is a vector of 1 with I rows, $N_{ij}$ is the quantity of nutrient $j$ that 1\$ spent on ingredient $i$ brings, $e_i$ is the dollar expenditure on ingredient $i$ and $d_j$ is the daily requirement in nutrient $j$. 

```{r Solving the problem}
N = t(themat[1:nbCommodities,3:11])
d = themat[(nbCommodities+1),3:11]
c = rep(1,nbCommodities)
result   = gurobi ( list(A=N,obj=c,modelsense="min",rhs=d,sense=">"), params=list(OutputFlag=0) ) 
q_yearly  = result$x * 365 # convert into yearly cost
pi = result$pi
cost_daily =  result$objval
```

In the object "result", we define: 

- the objective function : c
- the constraint : A = N
- the model "sense" : here it's a minimization, hence the "min"
- the right hand side of the constraint, here "d"
- and the sense of the inequality in the constraint: here ">"

*Note that if there are various constraints, the inequalities senses can be specified in a vector : c('<', '<', '>'). By default, R consider that the sense is positive. If there are no constraints to the problem, one shall specify "lb=-Inf".*

